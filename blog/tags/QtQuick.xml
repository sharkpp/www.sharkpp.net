<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title><![CDATA[さめたすたすのお家]]></title>
    <link href="http://www.sharkpp.net/blog/tags/QtQuick.xml" rel="self"/>
    <link href="http://www.sharkpp.net/"/>
    <updated>2018-03-26T16:16:33+00:00</updated>
    <id>http://www.sharkpp.net/</id>
            <author>
            <name><![CDATA[sharkpp]]></name>                    </author>
        <generator uri="http://sculpin.io/">Sculpin</generator>
            <entry>
            <title type="html"><![CDATA[続・QtQuick2でアプリ作ってみたよ]]></title>
            <link href="http://www.sharkpp.net/blog/2013/05/19/qtquick2-taskmemgraph.html"/>
            <updated>2013-05-19T18:48:00+00:00</updated>
            <id>http://www.sharkpp.net/blog/2013/05/19/qtquick2-taskmemgraph.html</id>
            <content type="html"><![CDATA[<p>勉強会の続きが結構かかってしまったけど何とかそれなりに形になりました。</p>

<p>もしくは、力尽きたともいうorz</p>

<p><img src="/images/2013_0519_qtquick2_mac.png" alt="QtQuick2 on Mac" /> <img src="/images/2013_0519_qtquick2_win.png" alt="QtQuick2 on Windows" /></p>

<p>とりあえず、完成までの流れおば</p>

<h2 id="qtquick2%E3%81%A7ui%E6%8F%8F%E7%94%BB%E3%82%92%E4%BD%9C%E6%88%90">QtQuick2でUI描画を作成</h2>

<p>勉強会ではここで力尽きました。</p>

<p>QtQuick2でCanvasエレメント上に円グラフを描き描きしてそれらしい形に。</p>

<p>後からTextエレメントでプロセス名の一覧とメモリの使用量を表示できるようにしました。</p>

<h3 id="%E5%8F%82%E8%80%83">参考</h3>

<ul>
<li><a href="http://qt-project.org/doc/qt-5.0/qtquick/qml-qtquick2-loader.html">QtQuick 5.0: Loader | Documentation | Qt Project</a></li>
<li><a href="http://qt-project.org/doc/qt-5.0/qtquick/qml-qtquick2-item.html">QtQuick 5.0: Item | Documentation | Qt Project</a></li>
<li><a href="http://relog.xii.jp/mt5r/2012/03/qmlqt-16.html">QML(Qt)のエレメントを動的に生成をする - 理ろぐ</a></li>
<li><a href="http://harmattan-dev.nokia.com/docs/platform-api-reference/xml/daily-docs/libqt4/qdeclarativemodels.html#qobjectlist-based-model">Qt 4.7: QML Data Models</a></li>
</ul>

<h2 id="qml%E3%81%A8c%2B%2B%E3%81%AE%E9%80%A3%E6%90%BA">QMLとC++の連携</h2>

<p>最初作ったプロジェクトではどうもC++の関数が呼べなかったらしく少し回り道を、、、してしまったがプロジェクトを作り直して準備完了。</p>

<p>単純なQStringとかを返すのではなくいろんな情報を持つオブジェクトを返したかったので少し変わった事をしています。</p>

<p><a href="https://github.com/sharkpp/TaskMemGraph/blob/master/processlist.h">TaskMemGraph/processlist.h at master - sharkpp/TaskMemGraph - GitHub</a> や <a href="https://github.com/sharkpp/TaskMemGraph/blob/master/processinfo.h">TaskMemGraph/processinfo.h at master - sharkpp/TaskMemGraph - GitHub</a> など で実装しているのですが、<code>ProcessInfo</code>クラスは<code>QObject</code>から派生していて、<code>Q_PROPERTY</code>でプロパティーを定義しています。</p>

<p>こうすると、QML側では、</p>

<pre><code>var v = item;
var yy = v.name;
</code></pre>

<p>みたいに呼び出せます。</p>

<p>で、<code>ProcessList</code>クラスも<code>QObject</code>から派生していて、<code>Q_INVOKABLE</code>で必要なメソッドを定義してあります。</p>

<p>戻り値を<code>QList&lt;QObject*&gt;</code>で定義するとQML側では、</p>

<pre><code>var v = hoge.data();
for(i in v) {
    var yy = v[i].name;
}
</code></pre>

<p>みたいに呼び出せます。</p>

<p>もちろん、</p>

<pre><code>qmlRegisterType&lt;ProcessInfo&gt;("ProcessLib",1,0,"ProcessInfo");
qmlRegisterType&lt;ProcessList&gt;("ProcessLib",1,0,"ProcessList");
</code></pre>

<p>のような感じで型の登録が必要になります。</p>

<p>ただ、なかなか思ったような処理のやり方がわからず探し回りました。</p>

<h3 id="%E5%8F%82%E8%80%83">参考</h3>

<ul>
<li><a href="http://utworks.net/?p=64">&#91;Qt&#93;&#91;QML&#93;QMLとC++コードの連携 - Utworks</a></li>
<li><a href="http://qt-project.org/doc/qt-4.8/qtbinding.html">Using QML Bindings in C++ Applications | Documentation | Qt Project</a></li>
<li><a href="http://d.hatena.ne.jp/hecomi/20130503/1367594609">QtQuick での C++ × QML バインディングについてまとめてみた - 凹みTips</a></li>
<li><a href="http://www.developer.nokia.com/Community/Wiki/Calling_Qt_class_methods_from_QML">Calling Qt class methods from QML - Nokia Developer Wiki</a></li>
<li><a href="http://stackoverflow.com/questions/14287252/accessing-c-qlists-from-qml">Accessing C++ QLists from QML - Stack Overflow</a></li>
</ul>

<h2 id="mac%E3%81%A7%E3%81%AE%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E6%93%8D%E4%BD%9C%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0">Macでのプロセス操作のプログラミング</h2>

<p>ここから、完全に未知の領域です。</p>

<p>Macのプログラム、なにそれ？おいしいの？状態でしたが、、、そもそも、何をキーワードにして検索をすればいいかとか どこを見ればいいかとかが分からず、今回一番苦労したところです。</p>

<p>結局は、<a href="https://developer.apple.com/">Apple Developer</a>が総本山だったってことが分かったのですが、それにしても 目的の処理をしようとする方法も分からず？？？な状態でしたが、まあ、何とかなるもんです。</p>

<h3 id="%E5%8F%82%E8%80%83">参考</h3>

<ul>
<li><a href="https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man3/sysctl.3.html">sysctl(3) Mac OS X Developer Tools Manual Page</a></li>
<li><a href="https://blogs.oracle.com/dns/entry/understanding_the_authorization_framework_on">Using task&#95;for&#95;pid on Mac OS X (Doug's Note System)</a></li>
<li><a href="http://os-tres.net/blog/2010/02/17/mac-os-x-and-task-for-pid-mach-call/">Mac OS X and task&#95;for&#95;pid() mach call - Ivan's blog</a></li>
<li><a href="https://www.evernote.com/pub/view/wishi/crazylazy/b213a94c-0780-4271-8c77-7da7f92a62b3?locale=ja#st=p&amp;n=b213a94c-0780-4271-8c77-7da7f92a62b3">Evernote 共有ノートブック: IT sec research</a></li>
<li><a href="http://qt-project.org/doc/qt-5.0/qtdoc/qmake-platform-notes.html">QtDoc 5.0: qmake Platform Notes | Documentation | Qt Project</a></li>
<li><a href="http://d.hatena.ne.jp/ny23/20100818/p2">(Mac OS X / LINUX での) 外部コマンドの消費メモリのモニタリング - ny23の日記</a></li>
</ul>

<h2 id="windows%E3%81%A7%E3%81%AE%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E6%93%8D%E4%BD%9C%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0">Windowsでのプロセス操作のプログラミング</h2>

<p>こっち側はまあAPIとかは少し探しましたが、まあそれなりで、、、</p>

<p>MSDNで日本語の内容も読めるし圧倒的に日本語の資料が多いので簡単です。</p>

<p>こういうところはユーザー数の違いが顕著に出ますね。</p>

<h2 id="%E3%81%BE%E3%81%A8%E3%82%81">まとめ</h2>

<p>初めてQtQuick2をやってみて、、、まあそれなりに手が動いたのはJavaScriptベースだったからでしょうか？</p>

<p>まだ、ちょっと自分の作りたい方向性のものとちょっと違うので、このままどっぷりはまっていくかというとそうでもなさそうですが、 雰囲気は掴めたので何かの時には、またを出しそうな感じです。</p>

<p>そもそも、初っ端からC++との連携とかMacのプロセス操作とかハードルが高すぎましたねorz</p>

<p><a href="https://github.com/sharkpp/TaskMemGraph">sharkpp/TaskMemGraph - GitHub</a>でソースを公開していますがバイナリはなんかdllがたくさん必要なので公開していません。 主にサイズ的な制限で、、、Windows側は必要なDLLが総計40MBですってよorz</p>

<p>ちなみに、動かすのに管理者権限が必要になります。</p>

<p>Mac側は確実に、そして、Windows側はXPでしか試していないですが、恐らく管理者権限が必要だと思います。</p>

<p>Macで動かしたアプリのスクショです。</p>

<p><a href="/images/2013_0519_qtquick2_mac.jpg"><img src="/images/2013_0519_qtquick2_mac.png" alt="QtQuick2 on Mac" /></a></p>

<p>こっちはWindowsで動かしたアプリのスクショです。</p>

<p><a href="/images/2013_0519_qtquick2_win.jpg"><img src="/images/2013_0519_qtquick2_win.png" alt="QtQuick2 on Windows" /></a></p>

<p>自分で試してみたいという奇特な方は、<a href="https://github.com/sharkpp/TaskMemGraph">sharkpp/TaskMemGraph - GitHub</a>からソースを取得して遊んでみてください。</p>

<p>ではでは</p>
]]></content>
        </entry>
    </feed>