<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title><![CDATA[さめたすたすのお家]]></title>
    <link href="http://www.sharkpp.net/blog/categories/%E3%83%96%E3%83%AD%E3%82%B0.xml" rel="self"/>
    <link href="http://www.sharkpp.net/"/>
    <updated>2017-09-27T03:44:41+00:00</updated>
    <id>http://www.sharkpp.net/</id>
            <author>
            <name><![CDATA[sharkpp]]></name>                    </author>
        <generator uri="http://sculpin.io/">Sculpin</generator>
            <entry>
            <title type="html"><![CDATA[じゅげむったーの開発日記 その６]]></title>
            <link href="http://www.sharkpp.net/blog/2017/09/27/jugemutter-development-diary-6th.html"/>
            <updated>2017-09-27T12:40:00+00:00</updated>
            <id>http://www.sharkpp.net/blog/2017/09/27/jugemutter-development-diary-6th.html</id>
            <content type="html"><![CDATA[<p>遅くなりましたが、今月も引き続き参加した <a href="https://qt-users.connpass.com/event/65548/">Qt 勉強会 @ Nagoya No12 - connpass</a> のまとめです。</p>

<p>重大発表があってちょっとびっくりでした。
それはともかく今回も長文投稿専用Twitterクライアントの開発の続きでした。</p>

<p>レポジトリは ... <a href="https://github.com/sharkpp/Jugemutter">sharkpp/Jugemutter: 長文投稿専用クライアント「じゅげむったー」</a> となります。</p>

<p>画面は...変わってないからいいですね。</p>

<h2 id="%E9%80%B2%E6%8D%97">進捗</h2>

<p>相変わらず <code>Could not authenticate you.</code> がなぜか出る、と。</p>

<p>そこで、先日に <a href="https://github.com/sharkpp/http-peeper">sharkpp/http-peeper: This is a proxy server for peeping HTTP/HTTPS communication, mainly for debugging.</a> と言うツールを NodeJS でサクッと作ってみました。
一言で言うと https 通信の間に割り込んで中身を見てしまうツールです。</p>

<p>今回は、これの改良というか改善？をして、他のソフトの通信の内容と比較してみました。</p>

<p>まあ、結果として、少なくともパラメータやヘッダなどには特に違いがなさそうだ、という事がわかりました。
困ったことに、全く解決になっていないです...</p>

<p>あとは、HMACなどの計算時に無駄にエスケープしている事で、サーバー側での検証時と値が違うのかなぁと。
まあ、そうだとすると Qt 側のバグなのですが...</p>

<p>と、まあそんなところで終了。</p>

<p>まあ、あとは重大発表として Qt 勉強会 @ Nagoya が残念なことに今回で一旦休止の発表があり（次回が一旦の〆）となってしまいました。
なかなか、会場の都合が付かないので難しいですねぇ。</p>

<h2 id="%E4%BB%96%E3%81%AE%E3%82%BD%E3%83%95%E3%83%88%E3%81%AE%E9%80%9A%E4%BF%A1%E3%82%92%E8%A6%97%E3%81%8D%E8%A6%8B">他のソフトの通信を覗き見</h2>

<p>先のツール（<a href="https://github.com/sharkpp/http-peeper">http-peeper</a>）、証明書は当然本物ではなく所謂オレオレ証明書と呼ばれているものを使っている都合、証明書の検証をしている（OpenSSL等のライブラリを使っている場合は基本検証している）とエラーが出てしまうのです。
そのために、そのままだと他のソフトには使えないのでした。
さてどうするか？と考えていたところ、そういえばオレオレ認証局の証明書を作りシステムに登録して信頼、その認証局で署名することで対応と書かれている記事を見かけた覚えがあったので、とりあえずツールに組み込む前に手作業でやって見ました。</p>

<h3 id="%E6%89%8B%E9%A0%86">手順</h3>

<p><code>openssl.conf</code> をコピーして書き換えたり、いろいろして見ましたが結局こんな感じで試しました。</p>

<pre><code class="console">$ mkdir demoCA
$ cd demoCA
$ mkdir newcerts certs crl private
$ chmod 700 private
$ touch index.txt
$ echo 00 |tee serial
$ openssl req -batch -new -x509 -sha256 -days 36500 -newkey rsa:4096 -out ca.crt -keyout demoCA/private/ca.key -subj "/C=JP/ST=Tokyo/L=Tokyo/O=root.http-peeper.local/OU=root.http-peeper.local/CN=root.http-peeper.local"
$ openssl rsa -in demoCA/private/ca.key -out demoCA/private/ca.key
$ openssl req -batch -new -sha256 -days 36500 -newkey rsa:4096 -out demoCA/server.csr -keyout demoCA/private/server.key -batch -subj "/C=JP/ST=Tokyo/L=Tokyo/O=root.http-peeper.local/OU=api.twitter.com/CN=api.twitter.com"
$ openssl rsa -in demoCA/private/server.key -out demoCA/private/server.key
$ openssl ca -batch -days 36500 -keyfile demoCA/private/ca.key -cert demoCA/ca.crt -in demoCA/server.csr -out demoCA/server.crt
</code></pre>

<p>そして <code>ca.crt</code> を開き</p>

<p><img src="/images/2017_0916_macos_cert_reg_to_system.png" alt="証明書の追加" /></p>

<p>と、システムに登録します。</p>

<p>登録したら「キーチェーンアクセス」から証明書を探し</p>

<p><img src="/images/2017_0916_macos_view_cert_detail.png" alt="証明書を右クリック" /></p>

<p>右クリックで「情報を見る」から「常に信頼」を選び</p>

<p><img src="/images/2017_0916_macos_trust_root_cert.png" alt="証明書を信頼" /></p>

<p>と信頼させます。</p>

<p><img src="/images/2017_0916_macos_trusted_cert.png" alt="キーチェーンアクセス" /></p>

<p>「キーチェーンアクセス」では「この証明書はこのアカウントにとって信頼されている物として指定されています」と表示されています。</p>

<p>あとは、 <code>server.key</code> と <code>server.crt</code> を</p>

<pre><code class="console">$ openssl x509 -in server.crt -out tmp.der -outform DER
$ openssl x509 -in tmp.der -inform DER -out server-cert.pem -outform pem
$ openssl rsa -in server.key -out tmp.der -outform DER
$ openssl rsa -in tmp.der -inform DER -out server-key.pem -outform pem
</code></pre>

<p>と .pem 形式に変換（元々.pemで利用していたため）し利用しました。</p>

<p>手順はツールに組み込んで自動化したいところですが、とりあえず他のソフトの通信を覗き見できるようになりました。</p>

<h2 id="%E5%8F%82%E8%80%83">参考</h2>

<ul>
<li><a href="http://qiita.com/mkgask/items/8d66dcada58a485e3585#_reference-0c1fe982bfae4639fb65">Chrome58以降でハネられないSHA-2でオレオレ認証局署名のあるオレオレ証明書 - Qiita</a></li>
<li><a href="http://qiita.com/ll_kuma_ll/items/13c962a6a74874af39c6#20170508%E8%BF%BD%E8%A8%98">オレだよオレオレ認証局で証明書つくる - Qiita</a></li>
<li><a href="http://qiita.com/softark/items/15a5280bd38c5dd97b48">オレオレ認証局とオレオレ証明書 - Qiita</a></li>
<li><a href="http://qiita.com/NakashimaKeisuke_zerodaynet/items/bfc77e5fe98b587532d0">SSL証明書設定でよくやってることをまとめる。 - Qiita</a></li>
<li><a href="http://qiita.com/kunichiko/items/12cbccaadcbf41c72735">RSA鍵、証明書のファイルフォーマットについて - Qiita</a></li>
<li><a href="https://hacknote.jp/archives/13939/">SSL証明書を.crtから.pemに変換する方法 | ハックノート</a></li>
<li><a href="http://certificate.fyicenter.com/2134_OpenSSL_ca_Error_..._directory_for_new_certificate_..._.html">OpenSSL - OpenSSL "ca" Error "... directory for new certificate ..."</a></li>
</ul>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[じゅげむったーの開発日記 その５]]></title>
            <link href="http://www.sharkpp.net/blog/2017/08/23/jugemutter-development-diary-5th.html"/>
            <updated>2017-08-23T01:50:00+00:00</updated>
            <id>http://www.sharkpp.net/blog/2017/08/23/jugemutter-development-diary-5th.html</id>
            <content type="html"><![CDATA[<p>さて、今月も引き続き参加した <a href="https://qt-users.connpass.com/event/62861/">Qt 勉強会 @ Nagoya No11 - connpass</a> のまとめ。</p>

<p>つぶやきは <a href="https://togetter.com/li/1146658">Qt 勉強会 @ Nagoya No11 つぶやきまとめ - Togetterまとめ</a> でまとめられています。</p>

<p>先月の勉強会から日付(YY.MM)が付かなくなりました。</p>

<p>さて、今回も長文投稿専用Twitterクライアントの開発の続きをしました。</p>

<p>レポジトリは ... <a href="https://github.com/sharkpp/Jugemutter">sharkpp/Jugemutter: 長文投稿専用クライアント「じゅげむったー」</a> です。</p>

<p><img src="/images/2017_0819_jugemutter1.png" alt="画面" /></p>

<h2 id="%E9%80%B2%E6%8D%97">進捗</h2>

<p><img src="/images/2017_0819_jugemutter2.png" alt="テスト画面" /></p>

<p>とりあえず、分割処理のいろんなパターンのテストがやっと通ったので、ようやく一山越えた感じです。
ここまで長かった。</p>

<p>で、<code>Could not authenticate you.</code> がなぜか出る、と。
これは、<a href="https://dev.twitter.com/overview/api/response-codes">Error Codes &amp; Responses — Twitter Developers</a> によると、『<ruby>ダイヤルしても通話を完了できませんでした。<rp>(</rp><rt>Your call could not be completed as dialed.</rt><rp>)</rp></ruby>』って意味らしい。</p>

<h2 id="wireshark-%E3%81%A7-https-%E3%81%AE%E4%B8%AD%E8%BA%AB%E3%81%AE%E7%A2%BA%E8%AA%8D">Wireshark で https の中身の確認</h2>

<p>Twitter の API への指示がおかしいらしいので、なんとか調べられないかとググってた所、Wiresharkでhttpsの中身が確認できるとの記事を発見。</p>

<pre><code># SSLKEYLOGFILE=~/tls_key.log {ChromeやFirefox、cURLなどのパス}
</code></pre>

<p>で起動し、Wireshark で</p>

<p><img src="/images/2017_0819_https_decrypt_in_wireshark.png" alt="Wireshark" /></p>

<p>と、このような設定をすれば良いらしい。</p>

<p>が、解析画面</p>

<p><img src="/images/2017_0819_wireshark.png" alt="Wireshark" /></p>

<p>を見ても、 <del><code>Decrypted SSL Data</code> なんてタブはもちろん、<code>Frame</code> などのタブも表示されていないので、もしかしてUIがQtベースになった時に何か変わったのかもしれない。</del></p>

<p><img src="/images/2017_0831_wireshark.png" alt="Wireshark" /></p>

<p><code>RSA keys list</code> の設定を触って居たら、なぜかタブが出るようになった。
実装自体はされているようだ。</p>

<p>あと、そもそもの話、Qtの通信を覗きたいのが目的。
なので、Qtで上の方法が使えないと意味がないんだけど使えるのだろうか？</p>

<h2 id="%E5%8F%82%E8%80%83">参考</h2>

<ul>
<li><a href="http://qiita.com/Hexa/items/ce0ac23526df12a64ad0">暗号化された Application Data を復号する - Qiita</a></li>
<li><a href="https://f-o.org.uk/2017/decrypting-https-traffic-without-a-key.html">Floating Octothorpe: Decrypting HTTPS traffic without a key</a></li>
<li><a href="https://serverfault.com/questions/263530/how-can-i-filter-https-when-monitoring-traffic-with-wireshark">How can I filter https when monitoring traffic with Wireshark? - Server Fault</a></li>
<li><a href="http://troushoo.blog.fc2.com/blog-entry-234.html">Wireshark を用いて、クライアント側の情報のみでHTTPS 通信を複合する方法</a></li>
<li><a href="http://qiita.com/toshihirock/items/acbf9800f7e784118e46">HTTPSのパケットをwiresharkで見てみる - Qiita</a></li>
<li><a href="https://gist.github.com/summerwind/a482dd1f8e9887d26199">Wireshark で HTTP/2 over TLS の通信をダンプする方法</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS/Key_Log_Format">NSS Key Log Format - Mozilla | MDN</a></li>
</ul>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[じゅげむったーの開発日記 その４]]></title>
            <link href="http://www.sharkpp.net/blog/2017/07/16/jugemutter-development-diary-4th.html"/>
            <updated>2017-07-16T18:10:00+00:00</updated>
            <id>http://www.sharkpp.net/blog/2017/07/16/jugemutter-development-diary-4th.html</id>
            <content type="html"><![CDATA[<p>ただいま、<a href="https://github.com/sharkpp/Jugemutter">じゅげむったー</a> の実装中なのです。</p>

<p>まあ、それはともかくとして、「じゅげむったー」実装中に Qt 関連で躓いた部分や発生した問題の解決方法を、メモしておいたら溜まってきたので一度放出しようかと。</p>

<h2 id="%E3%83%89%E3%83%AD%E3%83%83%E3%83%97%E3%83%80%E3%82%A6%E3%83%B3%E5%9E%8B%E3%81%AE%E3%83%80%E3%82%A4%E3%82%A2%E3%83%AD%E3%82%B0%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8Bmacos">ドロップダウン型のダイアログを表示する(macOS)</h2>

<p>macOS でウインドウのタイトルバーの直下からまるで舌ベロのように垂れ下がるドロップダウン形式のダイアログの実装方法。</p>

<p><img src="/images/2017_0716_macOS_QDialog_sheet_style.png" alt="QDialogのSheetスタイル" /></p>

<p>こんな感じのダイアログの表示スタイルです。</p>

<p>Apple 的には <code>[Sheet](https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Sheets/Concepts/AboutSheets.html)</code> って名称らしいですね。</p>

<pre><code class="cpp">#if defined(Q_OS_MAC)
    setWindowFlags(Qt::Sheet);
#endif
</code></pre>

<p>これだけです。</p>

<p><code>#if</code> と <code>#endif</code> はなくても良さそうですが、一応。</p>

<p>そうして <code>.exec()</code> などを呼び出せば表示できます。</p>

<h2 id="%E3%83%AA%E3%82%B9%E3%83%88%E4%B8%8B%E9%83%A8%E3%81%AE%E8%BF%BD%E5%8A%A0%E3%82%84%E5%89%8A%E9%99%A4%E3%83%9C%E3%82%BF%E3%83%B3macos">リスト下部の追加や削除ボタン(macOS)</h2>

<p><img src="/images/2017_0716_macOS_list_buttons.png" alt="リスト下部のボタン" /></p>

<p>こんな感じでリストの下部に追加や削除のボタンがついているやつ。</p>

<p>これは Apple 的には <code>NSAddTemplate</code> と <code>NSRemoveTemplate</code> って言うらしい。</p>

<p>この機能はどうやら実装されていないようなので、レイアウトとボタンをそれらしく配置することで再現するしかない様です。
まあ、Windows や Linux でも同じ機能にしたいなら、そちらの方が良いかもですね。</p>

<h2 id="qdialog-%E3%81%AE%E5%A4%A7%E3%81%8D%E3%81%95%E3%82%92%E3%82%B3%E3%83%B3%E3%83%86%E3%83%B3%E3%83%84%E3%81%AB%E5%90%88%E3%82%8F%E3%81%9B%E3%82%8B">QDialog の大きさをコンテンツに合わせる</h2>

<p>コンストラクタで <a href="http://doc.qt.io/qt-5/qwidget.html#adjustSize">void QWidget::adjustSize()</a> を呼び出せばOK。</p>

<pre><code class="cpp">MyDialog::MyDialog(QWidget *parent)
    : QDialog(parent)
    , ui(new Ui::MyDialog)
{
    ui-&gt;setupUi(this);
    adjustSize();
}
</code></pre>

<h2 id="%E3%82%AA%E3%83%BC%E3%83%90%E3%83%BC%E3%83%AD%E3%83%BC%E3%83%89%E3%81%95%E3%82%8C%E3%81%9F%E3%82%B7%E3%82%B0%E3%83%8A%E3%83%AB%E3%81%A8%E3%81%AE%E6%8E%A5%E7%B6%9A%E6%96%B9%E6%B3%95">オーバーロードされたシグナルとの接続方法</h2>

<p>Qt 5 から？だったか <code>connect(hoge, SIGNAL(...), ...)</code> ではなく <code>connect(hoge, &amp;..., ...)</code> で記述できるようになった。
なったのだけど、じゃあオーバーロードして宣言されているシグナルとの接続はどうするんだろう、と。</p>

<p>ちょうど必要な状況にぶち当たったので調べてみることに。</p>

<p>まず、</p>

<pre><code class="cpp">    connect(m_tagListWidget, &amp;QComboBox::currentIndexChanged,
            this, &amp;TagInput::onTagListSelected);
</code></pre>

<p>こんな感じで記述すると <code>error: no matching member function for call to 'connect'</code> みたいなエラーが出ます。</p>

<p>解決方法は、<code>QtGlobal</code> の <a href="http://doc.qt.io/qt-5/qtglobal.html#qOverload">QOverload</a> テンプレートクラスを利用すればいいみたいです。</p>

<pre><code class="cpp">    connect(m_tagListWidget, QOverload&lt;int&gt;::of(&amp;QComboBox::currentIndexChanged),
            this, &amp;MyClass::onCurrentIndexChanged);
</code></pre>

<p>C++14 が有効であれば、</p>

<pre><code class="cpp">    connect(m_tagListWidget, qOverload&lt;int&gt;(&amp;QComboBox::currentIndexChanged),
            this, &amp;MyClass::onCurrentIndexChanged);
</code></pre>

<p>こうれば良いようです。</p>

<h2 id="%E5%AD%90%E8%A6%81%E7%B4%A0%E3%81%B8%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%AB%E3%82%B7%E3%83%BC%E3%83%88%E3%82%92%E9%81%A9%E7%94%A8%E3%81%95%E3%81%9B%E3%81%AA%E3%81%84">子要素へスタイルシートを適用させない</h2>

<p>ウィジェットをカスタマイズするためにスタイルシートで単純に</p>

<pre><code class="css">QFrame { background: #F90; }
</code></pre>

<p>とした場合、これはもちろん、指定した要素に適用されます。</p>

<p>そして、実はこの時に子要素が存在していた場合、その子要素にまでその指定が効いてしまいます。
まあ、HTML のスタイルシートとして考えた場合には、確かにそれはそれで正しいのですが、ちょっと困り者ですね。</p>

<p>では、どうするか？</p>

<pre><code class="css">.QFrame { background: #F90; }
</code></pre>

<p>もしくは</p>

<pre><code class="css">#orangeColor { background: #F90; }
</code></pre>

<p>と要素を限定すればOKです。</p>

<h2 id="qtcreator-%E3%81%A7-qtoolbar-%E3%82%92%E8%87%AA%E7%94%B1%E3%81%AB%E8%A8%AD%E7%BD%AE%E3%81%99%E3%82%8B">QtCreator で QToolBar を自由に設置する</h2>

<p>QtCreator のデザイナでは、どうやら <a href="http://doc.qt.io/qt-5/qtoolbar.html">QToolBar</a> は、ウインドウ内に一つで、<code>QLabel</code> など他のウィジェットのように自由には配置できないようです。
もっとも、普通のアプリケーションでは問題ないとは思います。</p>

<p><code>QToolBar</code> をウィジェット的に扱う場合にはどうするか？</p>

<p>直接 .ui ファイルを編集します。
開くと、「このファイルはデザインモード以外では編集できません。」と出ますし、本来はダメなのですが...
どうしてもデザイナ上で扱いたかったんです。</p>

<p>手順は</p>

<ol>
<li>デザイナで QWidget を追加し、<code>objectName</code> を指定</li>
<li>対象の .ui を「エディタを指定して開く」→「テキストエディタ」で開く</li>
<li>1で指定した名前を探す</li>
<li>クラス名を変更する</li>
<li>ファイルを保存し閉じる</li>
<li>デザイナで開き直す</li>
</ol>

<p>となります。</p>

<p>クラス名の変更は</p>

<pre><code class="diff">      &lt;item&gt;
-      &lt;widget class="QWidget" name="widget1"&gt;
+      &lt;widget class="QToolBar" name="widget1"&gt;
        &lt;property name="sizePolicy"&gt;
</code></pre>

<p>こんな感じですね。</p>

<h2 id="qtoolbar-%E3%81%A7%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%AB%E3%82%B7%E3%83%BC%E3%83%88%E3%81%AE%E6%8C%87%E5%AE%9A%E3%81%8C%E5%8F%8D%E6%98%A0%E3%81%95%E3%82%8C%E3%81%AA%E3%81%84macos%E9%99%90%E5%AE%9A%EF%BC%9F">QToolbar でスタイルシートの指定が反映されない(macOS限定？)</h2>

<p>macOS ではどうやらスタイルシートの実装に不具合なのか仕様なのかがあるようで、背景色の指定がうまくできない時があるようです。
<a href="https://bugreports.qt.io/browse/QTBUG-12717?focusedCommentId=216435&amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-216435">[QTBUG-12717] Background color for QToolBar is not stylable on Mac - Qt Bug Tracker</a> では <code>border</code> を指定し問題を回避できると書かれていました。</p>

<pre><code class="css">QToolBar {
    background: red;
    border: none;
}
</code></pre>

<p>こんな感じです。</p>

<h2 id="qtoolbar-%E3%81%AE%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3%E3%82%92%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA">QToolbar のデザインをカスタマイズ</h2>

<p>完全にメモです。</p>

<p><a href="https://github.com/sharkpp/QToolbarCustomStyleSample">sharkpp/QToolbarCustomStyleSample</a> で利用したサンプルを公開しています。</p>

<h3 id="%E3%81%98%E3%82%85%E3%81%92%E3%82%80%E3%81%A3%E3%81%9F%E3%83%BC">じゅげむったー</h3>

<p><img src="/images/2017_0716_QToolbar_customize_Jugemutter.png" alt="QToolbar カスタマイズ：じゅげむったー" /></p>

<pre><code class="css">QToolBar {
    background: qlineargradient(spread:pad, x1:0, y1:0, x2:1, y2:0, stop:0 rgba(54, 54, 67, 255), stop:1 rgba(84, 84, 104, 255));
    border: none;
    icon-size: 48px;
}
QToolButton {
    background: transparent;
    padding: 2px;
    margin: 0;
    spacing: 0;
    border: none;
    width: 56px;
    height: 48px;
}
QToolButton:checked {
    background-color: qlineargradient(spread:pad, x1:0, y1:0, x2:1, y2:0, stop:0 rgba(13, 13, 16, 255), stop:1 rgba(33, 33, 41, 255));
}
QToolButton:hover, QToolButton:checked:hover {
    background-color: rgb(96, 96, 96);
}
QToolButton:pressed {
    background-color: rgb(64, 64, 64);
}
</code></pre>

<h3 id="qt-creator-%E9%A2%A8">Qt Creator 風</h3>

<p>あくまで、Qt Creator 風です。
選択時にアイコンの色が変わるとかその辺りは実装できていません。</p>

<p><img src="/images/2017_0716_QToolbar_customize_QtCreatorLike.png" alt="QToolbar カスタマイズ：Qt Creator 風" /></p>

<pre><code class="css">QToolBar {
    background: #444;
    border: none;
    icon-size: 24px;
    padding: 0;
    margin: 0;
    spacing: 0;
}
QToolBar QToolButton {
    background: transparent;
    border: none;
    width: 70px;
    padding: 4px;
    margin: 0;
    spacing: 0;
    color: #fff;
}
QToolBar QToolButton:checked,
QToolBar QToolButton:pressed {
    background: #282828;
}
</code></pre>

<h2 id="%E5%8F%82%E8%80%83">参考</h2>

<ul>
<li><a href="http://qiita.com/false-git@github/items/cbda9ddaaac5b6c81427">Qtアプリのサンプル - Qiita</a></li>
<li><a href="http://doc.qt.io/qt-5/appicon.html">Setting the Application Icon | Qt 5.8</a></li>
<li><a href="http://doc.qt.io/qt-5/qtwidgets-widgets-windowflags-example.html">Window Flags Example | Qt Widgets 5.8</a></li>
<li><a href="http://doc.qt.io/qt-5/qt.html#WindowType-enum">Qt Namespace #WindowType-enum | Qt Core 5.8</a></li>
<li><a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Sheets/Concepts/AboutSheets.html">About Sheets</a></li>
<li><a href="https://forum.qt.io/topic/33448/solved-resize-qdialog-to-fit-all-contents/9">[Solved] Resize QDialog to fit all contents? | Qt Forum</a></li>
<li><a href="http://www.qtcentre.org/threads/14099-How-to-stop-child-widgets-from-inheriting-parent-s-StyleSheet-and-use-system-default">How to stop child widgets from inheriting parent's StyleSheet and use system default?</a></li>
<li><a href="https://stackoverflow.com/questions/16794695/connecting-overloaded-signals-and-slots-in-qt-5">c++ - Connecting overloaded signals and slots in Qt 5 - Stack Overflow</a></li>
<li><a href="https://bugreports.qt.io/browse/QTBUG-12717">[QTBUG-12717] Background color for QToolBar is not stylable on Mac - Qt Bug Tracker</a></li>
<li><a href="https://stackoverflow.com/questions/10706357/nstableview-with-plus-and-minus-buttons">cocoa - NSTableView with Plus and Minus buttons - Stack Overflow</a></li>
</ul>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[Xperia Touch 開封の儀]]></title>
            <link href="http://www.sharkpp.net/blog/2017/06/27/unboxing-xperia-touch.html"/>
            <updated>2017-06-27T00:30:00+00:00</updated>
            <id>http://www.sharkpp.net/blog/2017/06/27/unboxing-xperia-touch.html</id>
            <content type="html"><![CDATA[<p><a href="http://www.sonymobile.co.jp/product/smartproducts/g1109/">Xperia Touch G1109</a> を買ってみたので開封の儀を執り行いました。</p>

<p>IT系のニュース記事で紹介されたときから気になっていましたが、先日の事、ついに予約開始している事に数日たってから気が付きました。
で、少し悩んだ末にえいやーで、ポチリ、ついにお家に届きました。</p>

<p><img src="/thumbs/9174c9d23a5280589de703c62f101b68-256x256.jpg" alt="開封の儀"></p>

<h2 id="%E9%96%8B%E5%B0%81%E3%81%AE%E5%84%80">開封の儀</h2>

<p>箱の梱包テープには燦然と輝く「SONY」の文字が...</p>

<p><a href="/images/2017_0627_xperia_touch_01.jpg"><img src="/thumbs/f83e6288cbce499b0d286620cf1ce7c2-256x256.jpg" alt="SONYな梱包テープ"></a></p>

<p>厳重な梱包</p>

<p><a href="/images/2017_0627_xperia_touch_02.jpg"><img src="/thumbs/9174c9d23a5280589de703c62f101b68-256x256.jpg" alt="梱包財から出て来たのは？"></a></p>

<p>そして、大きな化粧箱。いろんな製品がこんな感じの化粧箱に入っているけど、一番最初はどこだったんだろう？</p>

<p><a href="/images/2017_0627_xperia_touch_03.jpg"><img src="/thumbs/84b4925001632555113afc6b734dd683-256x256.jpg" alt="四角い化粧箱"></a></p>

<p>裏面</p>

<p><a href="/images/2017_0627_xperia_touch_04.jpg"><img src="/thumbs/8ef6ca2bafaf6f750ba7c9a716e0e423-256x256.jpg" alt="スペックなど"></a></p>

<p>化粧箱をぱかりと開く。</p>

<p><a href="/images/2017_0627_xperia_touch_05.jpg"><img src="/thumbs/90bb0d6fa54877c1e3e77ae0b8628e0f-256x256.jpg" alt="開封"></a></p>

<p>取説や電源などの付属品はスポンジの下に。</p>

<p><a href="/images/2017_0627_xperia_touch_06.jpg"><img src="/thumbs/bfc1a5d557bc0666599c45c06303c623-256x256.jpg" alt="付属品など"></a></p>

<p>大きさを「パックンフラワー」と比較。</p>

<p><a href="/images/2017_0627_xperia_touch_07.jpg"><img src="/thumbs/e8da2167a595a4673c03f8adb1e6b8a3-256x256.jpg" alt="大きさ比較"></a></p>

<p>XPERIA な起動ロゴ</p>

<p><a href="/images/2017_0627_xperia_touch_08.jpg"><img src="/thumbs/e3e26bed4313351a3eab0b97495b0964-256x256.jpg" alt="起動ロゴ"></a></p>

<p>解像度は 1366 x 768 の Full-WXGA ですね。</p>

<p><a href="/images/2017_0627_xperia_touch_09.png"><img src="/thumbs/cefdeea267be8e248ab0ed692193639c-455x455.png" alt="画面の大きさ"></a></p>

<p>中身は Android 7.0 のタブレットの模様</p>

<p><a href="/images/2017_0627_xperia_touch_10.png"><img src="/thumbs/7e42b73f537d0a0c993f7baff5431237-455x455.png" alt="Androidのバージョン"></a></p>

<h2 id="%E3%81%8A%E7%B5%B5%E6%8F%8F%E3%81%8D%E3%81%97%E3%81%A6%E8%A6%8B%E3%81%9F">お絵描きして見た</h2>

<p><a href="/images/2017_0627_xperia_touch_11.png"><img src="/thumbs/625d79158d79b3b312773879e096007a-455x455.png" alt="お絵描き"></a></p>

<h2 id="%E6%98%A0%E3%81%97%E3%81%A6%E3%81%BF%E3%81%9F">映してみた</h2>

<p>いろんな材質のテーブルや壁に投影して見ました。</p>

<h3 id="%E9%BB%92%E3%81%A3%E3%81%BD%E3%81%84%E9%9D%A2%E3%81%AB%E3%81%BA%E3%81%8B%E3%83%BC">黒っぽい面にぺかー</h3>

<p><a href="/images/2017_0627_xperia_touch_12.jpg"><img src="/thumbs/f02e4ec549f2fd3b48b0c6a44ea8db3d-256x256.jpg" alt="黒っぽい面に"></a></p>

<h3 id="%E7%99%BD%E3%81%84%E5%A3%81%E3%81%AB%E3%81%BA%E3%81%8B%E3%83%BC">白い壁にぺかー</h3>

<p><a href="/images/2017_0627_xperia_touch_13.jpg"><img src="/thumbs/c834161ebb4509ec60a15f4b428f604b-256x256.jpg" alt="白い壁に"></a></p>

<h3 id="%E6%9C%A8%E7%9B%AE%E5%A3%81%E3%81%AB%E3%81%BA%E3%81%8B%E3%83%BC">木目壁にぺかー</h3>

<p><a href="/images/2017_0627_xperia_touch_14.jpg"><img src="/thumbs/62005a7575ea5a7220403df15a396125-256x256.jpg" alt="木目壁に"></a></p>

<h3 id="%E7%9C%9F%E3%81%A3%E6%9A%97%E9%97%87%E3%81%AB%E3%81%BA%E3%81%8B%E3%83%BC">真っ暗闇にぺかー</h3>

<p><a href="/images/2017_0627_xperia_touch_15.jpg"><img src="/thumbs/406096b7290da0a6019f0d2c8389a4bf-256x256.jpg" alt="真っ暗闇に"></a></p>

<h2 id="%E3%82%82%E3%81%97%E3%81%8B%E3%81%97%E3%81%A6%E5%88%9D%E6%9C%9F%E4%B8%8D%E8%89%AF%EF%BC%9F">もしかして初期不良？</h2>

<p>色々と遊んでいたところ、ボイスコントロールが効かないことに気が付き、すわ！初期不良か！？と思いましたが、どうやら違っていました。</p>

<p>原因から書くと、電源ボタンのある面の保護フィルムを剥がしていなかったことで、マイクに蓋がされていて音声入力がうまくされていなかっただけでした。
気が付くまで、すごい焦ってましたが、気が付いてみると、何だそんな事かいというぐらいの拍子抜けな原因でした。</p>

<p><a href="/images/2017_0627_xperia_touch_16.jpg"><img src="/thumbs/5bd4b4cdc777cc2516ce4ef28a399e3d-256x256.jpg" alt="マイクはここ"></a></p>

<p>投影レンズがある面の保護フィルムは剥がしましたが、電源の方はボタン押せるしいいか、と思ってたのが仇となったようで。</p>

<p>参考に、確認した時のことをメモしておきます。</p>

<ol>
<li>ボイスコントロールのアプリをクリックしてセットアップ</li>
<li>セットアップ完了後に、「Hi Xperia (ハイ エクスペリア)」と呼び掛けて、と表示があったので呼びかける</li>
<li>何回か呼びかけるも、反応しないため、この時点でおかしいことに気が付く</li>
<li>大声で叫んでみたりするも反応なし</li>
<li>カメラで録画してみるも、ほとんどささやくような音量で記録されている</li>
<li>「設定」→「オーディオ設定」→「マイク感度」を探し当て、感度を「自動」から「大」へ変更</li>
<li>やはりだめ。初期不良か？と思い始める</li>
<li>ホーム画面のGoogle検索ボックスのマイクで音声認識してみると、「いまなんじ？」→「今汝」「今何時」と怪しいけど認識はされる</li>
<li>ここで、そういえばマイクはどこにあるのだろうと考え、はっと気が付く</li>
<li>保護フィルムを剥がためすと、認識された！</li>
</ol>

<p>と、当時を再現するとこのような感じでした。</p>

<h2 id="%E6%B0%97%E3%81%AB%E3%81%AA%E3%82%8B%E6%89%80">気になる所</h2>

<ul>
<li>待機状態(映像を映していないタイミング)でのバッテリーの減りが激しい(数時間でなくなる)
バッテリーで持ち運ぶ場合は電源Offの方がよさそう</li>
<li>待機状態でもボイスコントロールは反応するけど、画面ロック時は操作がブロックされる
これはしょうがないので、ロックをしないで使うしかない</li>
<li>ACアダプタのケーブルの長さが、85cmと意外と短い
USB type-C 延長、は大丈夫かわからないから、テーブルタップなどの現現の延長が必要かもしれない</li>
<li>壁側に投影した時のタッチの反応が悪い</li>
</ul>

<h2 id="%E3%81%BE%E3%81%A8%E3%82%81">まとめ</h2>

<p>しばらく遊んで見た感じ、投影されるキーボードでカタカタ、ターン！は難しいかなと。
結構、誤入力が発生する感じがする。
それよりも bluetooth キーボードを使ったほうがいい気がする。</p>

<p>じゃあ、何に向いているかというと、ゲームやお絵かきなど、指一本でできる作業であれば、いい感じに操作できそう。
公式ページからリンクが貼られている、フルーツを斬るゲームやエアーホッケーなゲームなどは思った通りに反応してかなり楽しい。
あとは、スマホ用のゲームは縦向き固定のことが多いのでちょっと操作し難しいかもしれない。</p>

<h2 id="%E5%8F%82%E8%80%83">参考</h2>

<ul>
<li><a href="http://www.sonymobile.co.jp/product/smartproducts/g1109/">Xperia Touch G1109 | ソニーモバイルコミュニケーションズ</a></li>
<li><a href="http://datapro.jbmia.or.jp/data/DPJ_Guide_3rd_JP_.pdf">データプロジェクター表記ガイドライン 第３版</a></li>
</ul>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[じゅげむったーの開発日記 その３]]></title>
            <link href="http://www.sharkpp.net/blog/2017/06/17/jugemutter-development-diary-3rd.html"/>
            <updated>2017-06-17T22:57:00+00:00</updated>
            <id>http://www.sharkpp.net/blog/2017/06/17/jugemutter-development-diary-3rd.html</id>
            <content type="html"><![CDATA[<p>さて、先月に引き続いて今月も参加した <a href="https://qt-users.connpass.com/event/58337/">Qt 勉強会 @ Nagoya No9(17.06) - connpass</a> のまとめ。</p>

<p>つぶやきは <a href="https://togetter.com/li/1127556">Qt勉強会 Tokyo #48 + @Nagoya #9 つぶやきまとめ</a> でまとめられています。</p>

<p>今回も長文投稿専用Twitterクライアントの開発の続きをしました。
そろそろ終わらせたいです...</p>

<p>レポジトリは ... <a href="https://github.com/sharkpp/Jugemutter">sharkpp/Jugemutter: 長文投稿専用クライアント「じゅげむったー」</a> です。</p>

<p><img src="/images/2017_0617_jugemutter1.png" alt="画面" /></p>

<h2 id="%E9%80%B2%E6%8D%97">進捗</h2>

<p>とりあえず、作ってた設定画面ができて、設定した内容も保存できたぞ！</p>

<p><img src="/images/2017_0617_jugemutter1.png" alt="設定画面" /></p>

<p>投稿画面の本文前後のテキストも表示できるようになったし、</p>

<p><img src="/images/2017_0617_jugemutter2.png" alt="投稿画面" /></p>

<p>インストーラ作るの？って聞かれた。
たしかに、配布どうするか、って問題はある。</p>

<p><a href="https://booth.pm/ja/items/122098">インストーラを作ろう！</a> を持ってたはずなので、それを参考にやってみようかとは思ってる。</p>

<h2 id="%E3%81%9D%E3%81%AE%E4%BB%96%E3%83%A1%E3%83%A2">その他メモ</h2>

<h3 id="%E3%83%87%E3%83%BC%E3%82%BF%E3%83%90%E3%82%A4%E3%83%B3%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">データバインディングについて</h3>

<p>データバインディングは QML の方が Widget より素直？直感的？で実装が楽、らしい。</p>

<p>QML は、かなり昔( <a href="https://github.com/sharkpp/TaskMemGraph">sharkpp/TaskMemGraph: sample of QtQuick2 application</a> )に触ってそれっきりなので、また色々覚えないとダメかもしれないけど、 Android とか iOS のアプリ作るなら Widget よりも最近は QML っぽいので、またやってみようと思う。</p>

<p>そういえば、 <a href="https://github.com/sharkpp/TaskMemGraph">TaskMemGraph</a> っていまビルド通るのだろうか？</p>

<h3 id="%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E6%A7%8B%E6%88%90">ディレクトリ構成</h3>

<p>ファイル数増えて困る、って問題。</p>

<p>何かキッチリ答えがあるわけでもないけど、</p>

<ul>
<li>機能ごと</li>
<li>モジュールごと</li>
</ul>

<p>みたいな感じで良いのでは、とアドバイス。</p>

<h3 id="qt-%E6%9C%AC%E4%BD%93%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">Qt 本体について</h3>

<p>Qt 5.9 は、ある人曰く、アップデートしても大丈夫なバージョンな気がする、とのこと。</p>

<p>LTS(=Long Term Support)版だけあって、最初から安定しているのかも。</p>

<h3 id="qtcretor-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">QtCretor について</h3>

<p>QtCretor 4.3.0 はどうも動作が怪しい部分があるらしい（自分はまだ 4.2.1 なので、あくまでらしい）。</p>

<p>前のバージョン、 4.2.1 では大丈夫だけど、ある機能のメニューをクリックしても反応しなかったり、クラスを追加しても、プロジェクトビューに追加されなかったり（再起動すると追加されている）、など。</p>

<p>Qt 5.9 に付属の QtCretor 4.3.1 は大丈夫かも？と言う話。
なお QtCretor 4.3.1 はこの記事を書いている時点では、単体でのダウンロードはできないようです。</p>

<h2 id="%E5%8F%82%E8%80%83">参考</h2>

<ul>
<li><a href="https://www.qt.io/download-open-source/#section-9">Qt - Download Open Source Step 3</a></li>
</ul>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[じゅげむったーの開発日記 その２]]></title>
            <link href="http://www.sharkpp.net/blog/2017/05/20/jugemutter-development-diary-2nd.html"/>
            <updated>2017-05-20T17:04:00+00:00</updated>
            <id>http://www.sharkpp.net/blog/2017/05/20/jugemutter-development-diary-2nd.html</id>
            <content type="html"><![CDATA[<p>さて、先月に引き続いて今月も参加した <a href="https://qt-users.connpass.com/event/57080/">Qt 勉強会 @ Nagoya No8(17.05) - connpass</a> のまとめ。</p>

<p>今月も、長文投稿専用Twitterクライアントの開発の続きをしました。</p>

<p>レポジトリは ... <a href="https://github.com/sharkpp/Jugemutter">sharkpp/Jugemutter: 長文投稿専用クライアント「じゅげむったー」</a> です。</p>

<p><img src="/images/2017_0520_jugemutter.png" alt="画面" /></p>

<h2 id="%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB">はじめに</h2>

<p>今日は、会場にほぼ時間ぴったりで到着(どうやら参加者中、最後だった模様)。</p>

<p>反時計回りで、本日のやることを宣言。</p>

<p>自分は、「じゅげむったー」の続き。</p>

<h2 id="%E3%82%84%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8">やったこと</h2>

<p>アカウント周りの管理処理の実装を組んだ。</p>

<p>とりあえず、アカウントの管理がUIが主だったのを別のクラスで管理するようにして、それの変更でUIが変わるように変更をした。</p>

<p>いつのまにか、投稿ができなくなってたので、ソースを追ったら、今表示しているビューに対してドキュメントが設定されてなかった様子。</p>

<p>なので、ビューにドキュメントを設定する処理を実装するが、完了にはもう少し時間が足らなかった。</p>

<p>暗号化処理、Qt標準でないのでどうしたものか？
<a href="https://github.com/roop/qblowfish">roop/qblowfish</a> とか <a href="https://github.com/xcoder123/QBlowfish">xcoder123/QBlowfish</a> とか使おうかな？
でも、<a href="https://ja.wikipedia.org/wiki/Twofish">Twofish</a> よりも設計年代が古いので Twofish のラッパーを作ったほうがいいのかも？</p>

<h2 id="%E5%8F%82%E8%80%83">参考</h2>

<ul>
<li><a href="https://github.com/roop/qblowfish">roop/qblowfish: An implementation of the Blowfish encryption algorithm in Qt.</a></li>
<li><a href="https://github.com/xcoder123/QBlowfish">xcoder123/QBlowfish: Simple blowfish encryption implementation in Qt with QByteArray support</a></li>
<li><a href="https://ja.wikipedia.org/wiki/Twofish">Twofish - Wikipedia</a></li>
</ul>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[macOS 上に Homebrew を利用して Inkscape をインストールする]]></title>
            <link href="http://www.sharkpp.net/blog/2017/04/30/Install-inkscape-using-homebrew-on-macos.html"/>
            <updated>2017-04-30T23:30:00+00:00</updated>
            <id>http://www.sharkpp.net/blog/2017/04/30/Install-inkscape-using-homebrew-on-macos.html</id>
            <content type="html"><![CDATA[<p>開発中のアプリのアイコンを作成するために <a href="https://inkscape.org/ja/">Inkscape</a> が必要だったのですが、先日に Inkscape と <a href="https://www.xquartz.org/">XQuartz</a> をアップデートしてから何が悪いのか起動しなくて難儀していたところで、解決方法を見つけたのでその方法の記録です。</p>

<p><img src="/thumbs/632bbe45529a94416b0f7e519f24e6bf-384x384.png" alt="Inkscape 0.92.1 version"></p>

<h2 id="%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB">はじめに</h2>

<p>解決方法ですが、実は公式のダウンロードページにしれっと書いてあったんですよね。</p>

<blockquote>
  <p><a href="https://inkscape.org/ja/download/mac-os/">Mac OS 版 | Inkscape</a></p>
  
  <p>For users who cannot wait to try out the new features and have some technical experience, alternative installation methods are available.</p>
  
  <p>(意訳：腕に覚えがあるなら新しいバージョンをインストールする別の方法があるけどどうする？)</p>
</blockquote>

<p>この記事を書いている時点(2017/04/30)では、どうやら最新バージョンの 0.92 系は .dmg が提供されていないので、ある意味、渡りに船かもと言うところも。</p>

<p>その方法 <a href="https://inkscape.org/ja/download/mac-os/#alternative_install_0.92">alternative installation methods</a> を確認すると、macOS の２大パッケージマネージャーの <a href="https://www.macports.org/">MacPorts</a> と <a href="https://brew.sh/">Homebrew</a> でのインストール方法が書いてあります。</p>

<p>自分の環境は、Homebrew なので、そちらでのビルドとインストールを試してみました。</p>

<p>ビルド時間などは、こんな感じ。</p>

<table>
<thead>
<tr>
  <th>パッケージ</th>
  <th>バージョン</th>
  <th align="right">ファイル数</th>
  <th align="right">サイズ</th>
  <th align="right">ビルド時間</th>
</tr>
</thead>
<tbody>
<tr>
  <td>openssl</td>
  <td>1.0.2k</td>
  <td align="right">1696</td>
  <td align="right">17.5MB</td>
  <td align="right">00:15:56</td>
</tr>
<tr>
  <td>python</td>
  <td>2.7.13</td>
  <td align="right">6337</td>
  <td align="right">86.7MB</td>
  <td align="right">00:04:03</td>
</tr>
<tr>
  <td>inkscape</td>
  <td>0.92.1</td>
  <td align="right">1019</td>
  <td align="right">128.3MB</td>
  <td align="right">00:27:50</td>
</tr>
</tbody>
</table>

<p>ちなみに、どうやらこの方法だとネイティブ版がビルドされるらしく日本語入力やシステムにインストールされているフォントが使えたりとか、嬉しい変化があったりもします。</p>

<h2 id="%E6%BA%96%E5%82%99">準備</h2>

<p>インストール前の準備として、Homebrew の環境を整えておきます。</p>

<p>まれに、パッケージのバージョンが上がっていたりするので、アップデートしておきます。</p>

<pre><code class="bash">$ brew update
</code></pre>

<p>また、以前に Homebrew で Inkscape をインストールしたことがある場合は、どうやらあらかじめアンインストールが必要のようです。</p>

<pre><code class="bash">$ brew uninstall inkscape
$ brew cleanup
</code></pre>

<h2 id="%E3%83%93%E3%83%AB%E3%83%89%EF%BC%86%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">ビルド＆インストール</h2>

<p>実際のところ、ビルド自体はコマンド一行で終わります。</p>

<pre><code class="bash">$ brew install caskformula/caskformula/inkscape
</code></pre>

<p>ビルドとインストールが</p>

<pre><code>$ brew install caskformula/caskformula/inkscape
==&gt; Tapping caskformula/caskformula
Cloning into '/usr/local/Homebrew/Library/Taps/caskformula/homebrew-caskformula'...
remote: Counting objects: 5, done.
           :
==&gt; make
==&gt; make install
🍺 /usr/local/Cellar/inkscape/0.92.1: 1,019 files, 128.3MB, built in 27 minutes 50 seconds
</code></pre>

<p>とこのような感じで終了したら、おもむろに</p>

<pre><code class="bash">$ inkscape
</code></pre>

<p>と入力します。
何もなければ Inkscape を起動できます。</p>

<p>インストール先の <code>/usr/local/Cellar/inkscape/0.92.1</code> は後で利用するので覚えておきます。</p>

<p>インストールした Inkscape のバージョンはこんな感じ。</p>

<p><a href="/images/2017_0430_inkscape_version.png"><img src="/thumbs/632bbe45529a94416b0f7e519f24e6bf-384x384.png" alt="Inkscape 0.92.1 version"></a></p>

<p>お疲れ様でした、と言いたいところですが、残念ながらこの状態では Launchpad に登録されていないので、もう一手間かける必要があります。</p>

<p>実は、</p>

<pre><code class="bash">$ brew cask install inkscape
</code></pre>

<p>でインストールすると、 .app がインストールされるようですが、現時点(2017/04/30)ではバージョンが 0.91-1 で、XQuartz 版で、実は裏で公式のパッケージをインストールしているだけなので日本語やフォントなどの制限があります。</p>

<h2 id="launchpad-%E3%81%B8%E3%81%AE%E7%99%BB%E9%8C%B2">Launchpad への登録</h2>

<p>以前は</p>

<pre><code class="bash">$ brew linkapps inkscape
</code></pre>

<p>みたいにすれば、できていたらしいけど、</p>

<blockquote>
  <p>Warning: <code>brew linkapps</code> has been deprecated and will eventually be removed!</p>
  
  <p>(訳：<code>brew linkapps</code>は廃止され、最終的に削除されます！)</p>
</blockquote>

<p>と怒られるので、別の方法をとります。</p>

<p>Inksacpe のインストール先は、先のビルド時のログに出てくる、<code>/usr/local/Cellar/inkscape/0.92.1</code> なので、<code>/bin/inkscape</code> を追加して、<code>"/usr/local/Cellar/inkscape/0.92.1/bin/inkscape"</code> が実態となります。</p>

<p>記録し忘れていたら、</p>

<pre><code class="bash">$ realpath $(which inkscape)
/usr/local/Cellar/inkscape/0.92.1/bin/inkscape
</code></pre>

<p>で確認できます。</p>

<p>スクリプトエディタで</p>

<pre><code class="AppleScript">tell application "/usr/local/Cellar/inkscape/0.92.1/bin/inkscape"
    activate
end tell
</code></pre>

<p>と入力して、</p>

<ol>
<li>「ファイル」メニュー</li>
<li>「書き出す...」</li>
<li>書き出し名＝「Inkscape」</li>
<li>ファイルフォーマット＝「アプリケーション」 ※ここが重要</li>
<li>「保存」を押下</li>
</ol>

<p><img src="/images/2017_0430_as2app.png" /></p>

<p>で、Inkscapeのランチャーアプリケーションを作成します。</p>

<p>書き出したアプリケーションを「アプリケーション」フォルダに入れれば完了です。</p>

<p>アプリケーションのアイコンはスクリプトファイルのアイコンがそのまま使われています。</p>

<p>「パッケージの内容を表示」で .app の中に潜ると</p>

<p><img src="/images/2017_0430_app_package_contents.png" /></p>

<p>のような感じになっているので、</p>

<p>るので、気になるようであれば、公式インストーラの .app から <code>Contents/Resources/inkscape.icns</code> を取り出し、 <code>Contents/Resources/applet.icns</code> を置き換えてあげれば</p>

<p><img src="/images/2017_0430_launcher_app_in_launchpad.png" /></p>

<p>こんな感じで Launchpad に表示されていると思います。</p>

<h2 id="%E3%81%BE%E3%81%A8%E3%82%81">まとめ</h2>

<ul>
<li>現状は 0.92.x に公式パッケージ(.dmg ファイル)は存在しない</li>
<li>Macports か Homebrew 経由で Inkscape の 0.92.x のネイティブ版(非XQuartz版)をビルド＆インストール可能</li>
<li>AppleScript でランチャーアプリを作れば Launchpad にも登録可能</li>
</ul>

<h2 id="%E5%8F%82%E8%80%83">参考</h2>

<ul>
<li><a href="http://a244.hateblo.jp/entry/2016/12/10/215848">MacPorts と開発版 Inkscape (0.92pre3) - ながいものには、まかれたくない</a></li>
<li><a href="https://inkscape.org/ja/download/mac-os/#alternative_install_0.92">Mac OS 版 | Inkscape</a></li>
<li><a href="http://qiita.com/nkimra/items/e30b5d120a6cae7ded8d">AppleScriptでアプリケーションの操作 - Qiita</a></li>
<li><a href="https://apple.stackexchange.com/questions/8299/how-do-i-make-an-applescript-file-into-a-mac-app">How do I make an AppleScript file into a Mac App? - Ask Different</a></li>
</ul>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[じゅげむったー(仮)の開発日記 その１]]></title>
            <link href="http://www.sharkpp.net/blog/2017/04/16/jugemutter-development-diary-1st.html"/>
            <updated>2017-04-16T23:07:00+00:00</updated>
            <id>http://www.sharkpp.net/blog/2017/04/16/jugemutter-development-diary-1st.html</id>
            <content type="html"><![CDATA[<p>さて、先月に続いて今月も参加した <a href="https://qt-users.connpass.com/event/53963/">Qt 勉強会 @ Nagoya No7(17.04) - connpass</a> のまとめ。</p>

<p>つぶやきは <a href="https://togetter.com/li/1101299">Qt勉強会 Tokyo #46 + Nagoya # 7 つぶやきまとめ - Togetterまとめ</a> でまとめられています。</p>

<p>今月は先月から作り始めた、長文投稿専用Twitterクライアントの開発をしました。</p>

<p>レポジトリは ... <a href="https://github.com/sharkpp/Jugemutter">sharkpp/Jugemutter: 長文投稿専用クライアント「じゅげむったー」</a> です。</p>

<h2 id="%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB">はじめに</h2>

<p>会場に到着する前のこと。</p>

<p>マクドナルドで昼食を食べ、いざ会場へ行かん、としたところで、外を見ると土砂降り，とまでは行かないけれど雨がザーザー<ruby><rb>OMG</rb><rp>(</rp><rt>おーまいがー</rt><rp>)</rp></ruby>。</p>

<p>慌ててコンビニで傘を買って行きましたとさ。
いや、まさか雨が降るとは思わず、折り畳み傘をカバンに入れてなかったのです。</p>

<p>会場に着くと、主催の <a href="https://twitter.com/nekomatu">@nekomatu</a> さん以外おらず。
もともと <a href="https://twitter.com/IoriAYANE">@IoriAYANE</a> さんも調子を崩して参加できず、だったので特に人数が少なかった。</p>

<p>しばらくして、最後の一人も到着で、もくもく開始。</p>

<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">本日のおやつ <a href="https://twitter.com/hashtag/qtjp?src=hash">#qtjp</a> <a href="https://t.co/HhGVbaUAWk">pic.twitter.com/HhGVbaUAWk</a></p>&mdash; 夜は短し歩けよさめたすたす (@sharkpp) <a href="https://twitter.com/sharkpp/status/853103000910413824">2017年4月15日</a></blockquote>

<h2 id="%E3%82%84%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8">やったこと</h2>

<p>ドキュメントを見つつ、画面周りを作成。</p>

<p>QtCreator みたいに左側にツールバーを設置してみようと思うが、どうやらデザイナ上ではウィジェットとしてツールバーは設置できないようだ。
「<a href="http://stackoverflow.com/questions/26691010/how-to-change-toolbar-layout-in-qt-creator">How to change toolbar layout in Qt Creator? - Stack Overflow</a>」 を見ると、 <code>.ui</code> を直接触れって書いてあって、確かにできるんだけど... いいのかな？</p>

<p><code>QPlainTextEdit</code> の画面内の余白、
<img src="images/2017_0415_qplaintextedit_margin.png" />
を計算するうまい方法はないものかと、探すも見つからず。
<a href="http://doc.qt.io/qt-5/qwidget.html#contentsMargins">QWidget::contentsMargins()</a>はどうも違うらしい。</p>

<p><code>QLabel</code> の文字色は ... そうだ、そうだ。
<code>foregroundRole()</code> を使うんだ、とか。</p>

<p>調べながら、コードを書いているとなかなか進まないなぁ。</p>

<h2 id="%E6%88%90%E6%9E%9C">成果</h2>

<p>とりあえず、なんとなくの画面はできてきた感じ。</p>

<p><img src="/images/2017_0415_jugemutter.png" /></p>

<p>もうちょっとで文章を分割してつぶやけるところまて行ったけど、残念ながら時間切れ。</p>

<ul>
<li>分割して投稿</li>
<li>文章をWYSIWYGで編集＆プレビューしたい</li>
<li>投稿のレジューム機能</li>
<li>マルチアカウント管理</li>
</ul>

<p>とか、まだまだ先は長そうだ。</p>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<h2 id="%E7%9F%A5%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8">知ったこと</h2>

<ul>
<li>Qt

<ul>
<li><a href="http://doc.qt.io/qt-5/properties.html"><code>Q_PROPERTY</code></a> は   <code>setProperty()</code> / <code>property()</code> でアクセスできるようにするマクロ。
何回か、同じ勘違いをやっているけど、 setter/getter を自動で作る機能ではない。</li>
<li>パスに日本語が含まれていると qmake が失敗するらしい、このご時世に。</li>
</ul></li>
<li>QtCreator

<ul>
<li>のソースエディタで、変数の後に <code>.</code> を入力すると <code>-&gt;</code> に変換される。便利！</li>
<li>デザイナ上でツールバーを削除してしまった場合は、オブジェクトインスペクタ？上の <code>QMainWIndow</code> を右クリックして「ツールバーを追加」で追加できる。</li>
<li><code>QDesignerCustomWidgetCollectionInterface</code> とか長ったらしい名前は <code>QDCW</code> と入力すれば補完される！
参考：<a href="http://qiita.com/task_jp/items/098319a33bd946955c0a#%E3%82%AD%E3%83%A3%E3%83%A1%E3%83%AB%E3%82%B1%E3%83%BC%E3%82%B9%E5%AF%BE%E5%BF%9C%E3%81%AE%E8%A3%9C%E5%AE%8C%E3%82%92%E6%9C%80%E5%A4%A7%E9%99%90%E3%81%AB%E6%B4%BB%E7%94%A8%E3%81%97%E3%82%88%E3%81%86">Qt Creator を便利に使いこなそう - Qiita # キャメルケース対応の補完を最大限に活用しよう</a></li>
<li><code>QString m_xxx;</code> などとメンバ変数を定義して、「リファクタリング」を実行すれば  <code>setXxx()</code> と <code>xxx()</code> つまり setter/getter の宣言と実装の枠組みが自動で追加される。
参考：* <a href="http://stackoverflow.com/questions/19729288/auto-generate-setters-getters-with-qtcreator">c++ - Auto-generate setters/getters with QTCreator? - Stack Overflow</a></li>
</ul></li>
</ul>

<h2 id="%E5%8F%82%E8%80%83">参考</h2>

<ul>
<li><a href="http://stackoverflow.com/questions/26691010/how-to-change-toolbar-layout-in-qt-creator">How to change toolbar layout in Qt Creator? - Stack Overflow</a></li>
<li><a href="http://stackoverflow.com/questions/18909507/qtextedit-sets-fix-line-height-paragraph-spacing">qt - QTextEdit sets fix line Height, paragraph spacing - Stack Overflow</a></li>
<li><a href="http://stackoverflow.com/questions/10317845/qplaintextedit-line-spacing">c++ - qplaintextedit line spacing - Stack Overflow</a></li>
<li><a href="http://qiita.com/task_jp/items/098319a33bd946955c0a#%E3%82%AD%E3%83%A3%E3%83%A1%E3%83%AB%E3%82%B1%E3%83%BC%E3%82%B9%E5%AF%BE%E5%BF%9C%E3%81%AE%E8%A3%9C%E5%AE%8C%E3%82%92%E6%9C%80%E5%A4%A7%E9%99%90%E3%81%AB%E6%B4%BB%E7%94%A8%E3%81%97%E3%82%88%E3%81%86">Qt Creator を便利に使いこなそう - Qiita</a></li>
<li><a href="http://stackoverflow.com/questions/2749798/qlabel-set-color-of-text-and-background">qt - QLabel: set color of text and background - Stack Overflow</a></li>
<li><a href="http://doc.qt.io/qt-5/properties.html">The Property System | Qt Core 5.8</a></li>
<li><a href="http://stackoverflow.com/questions/19729288/auto-generate-setters-getters-with-qtcreator">c++ - Auto-generate setters/getters with QTCreator? - Stack Overflow</a></li>
</ul>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[技術書典2に行ってきた]]></title>
            <link href="http://www.sharkpp.net/blog/2017/04/10/techbookfest2.html"/>
            <updated>2017-04-10T23:50:00+00:00</updated>
            <id>http://www.sharkpp.net/blog/2017/04/10/techbookfest2.html</id>
            <content type="html"><![CDATA[<p>去年から始まった技術書オンリーな同人イベント、「<a href="https://techbookfest.org/event/tbf02">技術書典２</a>」が、昨日の 4月9日に開催されました。
今年も小雨が降る天気の中、去年の「技術書典」に引き続き行ってきました。
これは、そのレポート、もしくは戦果報告となります。</p>

<p><img src="/images/2017_0409_tf2.jpg" alt="会場前にて" /></p>

<h2 id="%E5%A7%8B%E3%82%81%E3%81%AB">始めに</h2>

<p>まず、去年のレポートは「<a href="/blog/2016/06/27/techbookfest.html">技術書典に行ってきた — さめたすたすのお家</a>
」です。</p>

<p>去年は、参加サークル数が 57 で、入場者数は、1400 名でした。
今年は、場所を通運会館から秋葉原UDXホールへ移し、サークル数200？、入場者数が3100名 (<a href="https://twitter.com/TechBooster/status/850983169037697024">※</a>)と、大幅に増えています。</p>

<h2 id="%E5%BD%93%E6%97%A5">当日</h2>

<p>時間ピッタリで行ったら、すでに長蛇の列ができていたという去年の反省を踏まえ、かつ、公式より</p>

<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr"><a href="https://twitter.com/hashtag/%E6%8A%80%E8%A1%93%E6%9B%B8%E5%85%B8?src=hash">#技術書典</a> 当日の一般入場についてお伝えします！ 11時より一般入場開始ですが、前回の反省を踏まえ秋葉原UDXでは10時より列形成開始の予定です。しかしながら、朝が一番人員繰りが厳しい時間帯なのでお手柔らかにお願いします。10時から列整理に割いている人員はわずかです…！</p>&mdash; TechBooster@超技術書典 (@TechBooster) <a href="https://twitter.com/TechBooster/status/849875400465371136">2017年4月6日</a></blockquote>

<p>というアナウンスがあったので、10時に会場へ到着するよう行動しました。
まあ、現実は非情ですでにそこそこ並んでいたわけですが。</p>

<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr"><a href="https://twitter.com/hashtag/%E6%8A%80%E8%A1%93%E6%9B%B8%E5%85%B82?src=hash">#技術書典2</a> 来たけど10時の時点でエラいことに。列に並んでいると、Androidがとか、gitが、slackが、ハッカソンが、ハンダが、抵抗がとか、技術系の会話がなされてるのは興味深い <a href="https://t.co/Fd3fe2ePzx">pic.twitter.com/Fd3fe2ePzx</a></p>&mdash; ともかく、さめたすたすには気をつけて。 (@sharkpp) <a href="https://twitter.com/sharkpp/status/850878524860669957">2017年4月9日</a></blockquote>

<p>で、列の待機中は、</p>

<p><a href="/images/2017_0409_tf2_map.png"><img src="/thumbs/76f83f6553b2ac95822f722833c9c297-256x256.png" alt="探索マップ"></a></p>

<p>こんなマップを作っていたり、つぶやいたりして時間を潰していました。
途中、少し肌寒くトイレが近くて危なかったけど、何とかなった。</p>

<p>スタッフさんの「8ビットに並んで」とか、並んでいる人の、git がーとか、Rails がーとか、言う話を BGM で聞きつつ、あぁ、技術系のイベントなんだなぁと、しみじみ。</p>

<p>途中、スタッフさんが、赤い手提げバッグを持って回っているなぁと思ったら、どうやら「技術季報？？？」ってタイトルの要するにはパンフレットを配ってたので、もちろん購入。</p>

<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr"><a href="https://twitter.com/hashtag/%E6%8A%80%E8%A1%93%E6%9B%B8%E5%85%B82?src=hash">#技術書典2</a> まだ開場前だけどスタッフさんが購入しませんかってまわってきたのでもちろん挙手。技術季報（￥1000）の創刊号をゲットした！超会議の情報も載っているようだ <a href="https://t.co/HjPSDf6GAN">pic.twitter.com/HjPSDf6GAN</a></p>&mdash; ともかく、さめたすたすには気をつけて。 (@sharkpp) <a href="https://twitter.com/sharkpp/status/850885307771650048">2017年4月9日</a></blockquote>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>まあ、これは後からでも会場内で買えるのは分かっていたけど、なんとなく先に購入。
手提げバッグだけの場合は、無料で貰えたようです。</p>

<p>そうこうするうちに、半歩前へ詰め、列が更に4列加わり、あ、これはエラいことになるなと。
どうやら最終的にビルを回り込んで反対側まで列が伸びていた様子。</p>

<p>そして、開場時間を超え最終確認に数分を掛けて、ついに開場。
８人✕２“行”ずつの入場で、自分は５番目ぐらいの“行”だったから、前に多分 70 人前後はいた計算。</p>

<p>会場内に入り、早速お目当てのサークルさんを駆け巡る。</p>

<p>戦利品は後ほどで。</p>

<p>知り合いのサークルさんに挨拶しつつ、新刊を買いつつ、本を、時には本以外を購入していると、お金に羽が生えたように財布から飛んで行きました。</p>

<p>ともかく、一時間ぐらい会場内にいたけど、入場制限をしていたため、多少は窮屈だったけどそこまでギュウギュウということはなかったので良かったかなぁ。
まあ、企業ブース前はもう少し広く取ってほしかったけど。
あとは、新刊落としました、とか、未だに来て射ないサークルがあったり、とか、まあそんな感じ。</p>

<p>グルッと一周りして、購入忘れがないことを確認。
知り合いのサークルさんに再度挨拶をして会場を出ました。</p>

<p>最後は、去年と同じように、秋葉原のヤマト運輸営業所で荷物を発送、身軽になって帰りましたとさ。</p>

<h2 id="%E6%88%A6%E5%88%A9%E5%93%81">戦利品</h2>

<p>今回の戦利品</p>

<p><img src="/images/2017_0409_tf2_booty.jpg" alt="戦利品" /></p>

<table>
<thead>
<tr>
  <th>ブース</th>
  <th>サークル名</th>
  <th>備考</th>
</tr>
</thead>
<tbody>
<tr>
  <td></td>
  <td>達人出版会</td>
  <td>「技術季報 2017 SPRING」※技術書典カタログ</td>
</tr>
<tr>
  <td>あ-10</td>
  <td>docker-machine（ドッカーマシーン）</td>
  <td>「技術者のためのやさしい数学」</td>
</tr>
<tr>
  <td>い-05</td>
  <td>空と月</td>
  <td>「兎と亀」</td>
</tr>
<tr>
  <td>い-10</td>
  <td>TOKYO FLIP-FLOP（トーキョーフリップフロップ）</td>
  <td>「フロッピーせんべい」「アクリル製フロッピー」２種</td>
</tr>
<tr>
  <td>う-11</td>
  <td>ひみつラボ</td>
  <td>「RustでGBAのプログラムを作ろう！」</td>
</tr>
<tr>
  <td>え-05</td>
  <td>NP-complete（エヌピーコンプリート）</td>
  <td>「WEBASSEMBLY USUI BOOK</td>
</tr>
<tr>
  <td>え-28</td>
  <td>理ろぐ</td>
  <td>「Qt Quickを使いこなすクロスプラットフォームUIプログラミング2」</td>
</tr>
<tr>
  <td>お-05</td>
  <td>イプシロン</td>
  <td>「立体写真のつくりかた解説」</td>
</tr>
<tr>
  <td>お-12</td>
  <td>めがねをかけるんだ（メガネヲカケルンダ）</td>
  <td>「TensorFlowはじめました」</td>
</tr>
<tr>
  <td>き-10</td>
  <td>ラムダノート株式会社</td>
  <td>「Ruby でつくる Ruby」</td>
</tr>
<tr>
  <td>き-15</td>
  <td>株式会社ブックウォーカー</td>
  <td>「かんたん電子書籍」※無料配布</td>
</tr>
</tbody>
</table>

<p>※敬称略</p>

<h2 id="%E3%81%BE%E3%81%A8%E3%82%81">まとめ</h2>

<p>今回の教訓やメモなど</p>

<ul>
<li>公式のアナウンスをよく見ておこう。</li>
<li>トイレは事前に済ませること。</li>
<li>チラシがぐちゃぐちゃになるから A4 クリアファイルを持って行こう</li>
<li>来年もあれば行こう（超会議はパスしました）</li>
</ul>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[Qt Network Authorization を使った Twitter API の利用]]></title>
            <link href="http://www.sharkpp.net/blog/2017/03/25/twitter-api-using-qt-network-authorization.html"/>
            <updated>2017-03-25T22:59:00+00:00</updated>
            <id>http://www.sharkpp.net/blog/2017/03/25/twitter-api-using-qt-network-authorization.html</id>
            <content type="html"><![CDATA[<p>さて、先月に続いて今月も参加した <a href="https://qt-users.connpass.com/event/52009/">Qt 勉強会 @ Nagoya No6(17.03)</a> のまとめ。</p>

<p>今回はいつもに増して短め。</p>

<p><a href="https://github.com/sharkpp/Jugemutter">sharkpp/Jugemutter: 長文投稿専用クライアント「じゅげむったー」</a> で成果物を公開しています。</p>

<h2 id="%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB">はじめに</h2>

<p>まずは、クラスの実装をしていきます。</p>

<p><a href="https://doc-snapshots.qt.io/qt5-5.8/examples-qtnetworkauth.html">Qt Network Authorization Examples | Qt Network Authorization 5.8</a> に Twitter認証のサンプルがあるので、それを参考にしつつ <a href="https://github.com/sharkpp/NetworkStorageAccessSample">NetworkStorageAccessSample</a> で実装した認証済みトークンの保存処理を実装していきました。</p>

<p>あ、<a href="http://www.sharkpp.net/blog/2017/01/28/first-impression-qt-network-authorization.html">はじめての Qt Network Authorization</a> も参考にしています。</p>

<p>そろそろ、だれか Qt Network Authorization を触った記事を書いてくれないだろうか？</p>

<h2 id="%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88">ポイント</h2>

<p>実装するクラスは <code>QOAuth1</code> クラスから派生します。</p>

<p>これは、認証した後のトークンの復帰処理で <code>setStatus(QAbstractOAuth::Status::Granted)</code> の実行が必要となります。
ただし、該当のメソッドが <code>protected</code> として実装されているので、 <code>QOAuth1</code> クラスから派生する必要があるのです。</p>

<p>APIの各エンドポイントを設定</p>

<p>まあ、この辺はサンプルと同じです。</p>

<pre><code class="cpp">setTemporaryCredentialsUrl(QUrl("https://api.twitter.com/oauth/request_token"));
setAuthorizationUrl(QUrl("https://api.twitter.com/oauth/authenticate"));
setTokenCredentialsUrl(QUrl("https://api.twitter.com/oauth/access_token"));
</code></pre>

<p>OAuth の認証を、ブラウザを利用するために、</p>

<pre><code class="cpp">setReplyHandler(new QOAuthHttpServerReplyHandler(this));
</code></pre>

<p>としますが、これを実行するとポートを開きに行くので、必要な時のみポートを開くか PIN 認証にする方が良いかもしれません。</p>

<p>この時、</p>

<pre><code class="cpp">connect(this, &amp;QAbstractOAuth::authorizeWithBrowser,
        this, &amp;Twitter::handleAuthorizeWithBrowser);
</code></pre>

<p>としてシグナルをスロットと関連づけて、</p>

<pre><code class="cpp">void Twitter::handleAuthorizeWithBrowser(QUrl url)
{
    QDesktopServices::openUrl(url);
}
</code></pre>

<p>のような感じで実装することで、ブラウザで認証することができます。</p>

<p><code>grant()</code> を呼び出すことで認証開始するので、適当なメソッドでラップします。</p>

<p>認証後は、</p>

<pre><code>connect(this, &amp;QOAuth1::granted, this, &amp;Twitter::authenticated);
</code></pre>

<p>とすることで、 <code>authenticated()</code> を認証時に呼ばされるシグナルとして登録できます。</p>

<p>つぶやくには</p>

<pre><code>    QUrl url("https://api.twitter.com/1.1/statuses/update.json");
    QUrlQuery query(url);
    query.addQueryItem("status", "hogehoge");
    url.setQuery(query);
    QNetworkReply *reply = post(url);
    connect(reply, &amp;QNetworkReply::finished, this, &amp;Twitter::tweetFinished);
</code></pre>

<p>みたいな感じです。</p>

<p>まあ、後から振り返ると割と簡単な部類になると思うけど、いろいろハマってしまいました。</p>

<h2 id="%E3%81%84%E3%82%8D%E3%81%84%E3%82%8D%E5%A4%B1%E6%95%97%E8%AB%87">いろいろ失敗談</h2>

<p>なぜか今回はハマることハマること。</p>

<p>ハマった所をメモとして残しておきます。</p>

<ul>
<li><code>setClientIdentifier()</code> / <code>setClientSharedSecret()</code> と <code>token()</code> / <code>tokenSecret()</code> をなぜかとり間違える
なぜ間違えたし。</li>
<li>設定したはずの、Consumer Key / Consumer Secret が設定されていなくて、<code>QOAuthOobReplyHandler::networkReplyFinished: Host requires authentication</code> とデバッグ主力に出る。
<code>setModifyParametersFunction</code> で今の Stage とライブラリのソースをにらめっこで原因を見つけた。</li>
<li>呟く内容が別の変数を参照していたために空っぽで <code>Missing required parameter: status.</code> と返答が返ってくる。
うん、たしかに設定されてなかったね。</li>
<li><del><code>connect()</code> でラムダ式を使うとなぜか <code>qobject_cast&lt;QNetworkReply*&gt;(sender())</code> が <code>nullptr</code>。</del>
<del>横着せずに 別メソッドを作って設定すると大丈夫だった。何で？</del>
後で試したら大丈夫だった。</li>
</ul>

<p>と、こんな感じ。</p>

<p>結局、時間内になんとかつぶやきを書き込むまでは行けたけど、先のハマりがなければ、もう少し行けたかもしれない。</p>

<h2 id="%E3%83%84%E3%82%A4%E3%83%83%E3%82%BF%E3%83%BC%E3%81%AE%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E7%99%BB%E9%8C%B2">ツイッターのアプリケーション登録</h2>

<p><a href="https://apps.twitter.com/app/new">Create an application | Twitter Application Management</a> でアプリケーションを登録できる。</p>

<p>ただし、電話番号を認証していないと <ruby><rb>You must add your mobile phone to your Twitter profile before creating an application.</rb><rp>(</rp><rt>アプリケーションを作成する前に携帯電話を Twitter プロファイルに追加する必要があります。</rt><rp>)</rp></ruby> って怒られる。</p>

<p>一度登録したら、電話番号の登録を解除しても、登録内容の変更とかは問題なくできる模様。</p>

<p>で、登録時、SMSで飛んでくるトークンを何回入力しても弾かれるので、途方にくれてたけど <a href="http://absg.hatenablog.com/entry/2015/01/26/163057">twitterの電話番号認証がうまくいかないとき - やったこと</a> を見たらリロードすれば大丈夫のようなので試して見たらできた。
何じゃそりゃ？</p>

<p>まあともかく、アプリケーションを登録したら、Consumer Key / Consumer Secret を確認しアプリケーションに設定。</p>

<p>これでOK。</p>

<h2 id="%E5%8F%82%E8%80%83">参考</h2>

<ul>
<li><a href="http://www.sharkpp.net/blog/2017/01/28/first-impression-qt-network-authorization.html">はじめての Qt Network Authorization — さめたすたすのお家</a></li>
<li><a href="https://doc-snapshots.qt.io/qt5-5.8/examples-qtnetworkauth.html">Qt Network Authorization Examples | Qt Network Authorization 5.8</a></li>
<li><a href="https://dev.twitter.com/docs">Twitter Developer Documentation — Twitter Developers</a></li>
<li><a href="https://github.com/sharkpp/NetworkStorageAccessSample">sharkpp/NetworkStorageAccessSample: Qt Network Authorization "Network storage access" sample</a></li>
<li><a href="https://syncer.jp/Web/API/Twitter/REST_API/POST/statuses/update/">POST statuses/update - ツイートを投稿する</a> ※情報が古いようだ</li>
<li><a href="http://westplain.sakuraweb.com/translate/twitter/Documentation/REST-APIs/Public-API/POST-statuses-update.cgi">POST statuses/update - Twitter 開発者ドキュメント 日本語訳</a></li>
<li><a href="https://dev.twitter.com/rest/tools/console">API Console — Twitter Developers</a></li>
<li><a href="http://absg.hatenablog.com/entry/2015/01/26/163057">twitterの電話番号認証がうまくいかないとき - やったこと</a></li>
</ul>
]]></content>
        </entry>
    </feed>