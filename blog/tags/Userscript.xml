<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title><![CDATA[さめたすたすのお家]]></title>
    <link href="http://www.sharkpp.net/blog/tags/Userscript.xml" rel="self"/>
    <link href="http://www.sharkpp.net/"/>
    <updated>2017-05-05T11:18:51+00:00</updated>
    <id>http://www.sharkpp.net/</id>
            <author>
            <name><![CDATA[sharkpp]]></name>                    </author>
        <generator uri="http://sculpin.io/">Sculpin</generator>
            <entry>
            <title type="html"><![CDATA[JavaScript の選択範囲関連のメモ]]></title>
            <link href="http://www.sharkpp.net/blog/2015/08/29/javascript-memo-selection-object.html"/>
            <updated>2015-08-29T23:00:00+00:00</updated>
            <id>http://www.sharkpp.net/blog/2015/08/29/javascript-memo-selection-object.html</id>
            <content type="html"><![CDATA[<p>以前に作った <a href="https://greasyfork.org/ja/scripts/9647-calculation-of-selection-length">calculation of selection length</a> (ソースは<a href="https://github.com/sharkpp-userscripts/calculation-of-selection-length">GitHub</a>) を作る時に内容は選択された文字列の扱い関連について調べたことをメモメモです。
Chrome でのみ確認している。</p>

<h2 id="%E9%81%B8%E6%8A%9E%E6%96%87%E5%AD%97%E6%95%B0%E3%82%92%E5%8F%96%E5%BE%97">選択文字数を取得</h2>

<p>選択範囲は <code>document.getSelection()</code> または <code>window.getSelection()</code> で取得できる。</p>

<p>取得できるのは <code>Selection</code> オブジェクトなので、</p>

<pre><code class="bash">var selectionLen = String(document.getSelection()).length;
</code></pre>

<p>の用な感じで <code>String</code> に変換してから取得する。</p>

<h2 id="%E9%81%B8%E6%8A%9E%E3%81%AE%E5%A4%89%E6%9B%B4%E3%82%92%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%A7%E5%8F%96%E5%BE%97">選択の変更をイベントで取得</h2>

<p>どうやら標準ではないっぽいけど <code>onselectionchange</code> というイベントがあるみたい。</p>

<pre><code class="bash">document.addEventListener("selectionchange", function(e){ console.log(e); }, false);
</code></pre>

<h2 id="%E9%81%B8%E6%8A%9E%E7%AF%84%E5%9B%B2%E3%81%AE%E7%B5%B6%E5%AF%BE%E4%BD%8D%E7%BD%AE%E3%82%92%E5%8F%96%E5%BE%97">選択範囲の絶対位置を取得</h2>

<p>絶対位置を取得は、</p>

<pre><code class="bash">var getSelectionBoundingRect = function() {
  var rect = { left: 0, top: 0, right: 0, bottom: 0 };
  var selAll = document.getSelection();
  for (var i = 0; i &lt; selAll.rangeCount; ++i) {
    var rect_ = selAll.getRangeAt(i).getBoundingClientRect();
    if (rect_.left  &lt; rect.left)    rect.left   = rect_.left;
    if (rect_.top   &lt; rect.top)     rect.top    = rect_.top;
    if (rect.right  &lt; rect_.right)  rect.right  = rect_.right;
    if (rect.bottom &lt; rect_.bottom) rect.bottom = rect_.bottom;
  }
  rect.width  = rect.right - rect.left;
  rect.height = rect.bottom - rect.top;
  rect.left  += window.pageXOffset;
  rect.top   += window.pageYOffset;
  rect.right += window.pageXOffset;
  rect.bottom+= window.pageYOffset;
  return selAll.rangeCount ? rect : null;
};
</code></pre>

<p>こんな感じ。</p>

<h2 id="%E5%8F%82%E8%80%83">参考</h2>

<ul>
<li><a href="http://www.nishishi.com/javascript/2013/get-selection-length.html">範囲選択されている文字列を得る - JavaScript TIPSふぁくとりー</a></li>
<li><a href="https://developer.mozilla.org/ja/docs/Web/API/Selection">selection - Web API インターフェイス | MDN</a></li>
<li><a href="http://help.dottoro.com/ljixpxji.php">onselectionchange event | selectionchange event JavaScript</a></li>
<li><a href="http://gifnksm.hatenablog.jp/entry/20101007/1286419969">TextNodeにも使えるgetBoundingClientRect - gifnksmの雑多なメモ</a></li>
</ul>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[Wide style for mediawiki]]></title>
            <link href="http://www.sharkpp.net/blog/2010/03/28/greasemonkey-wide-style-for-mediawiki.html"/>
            <updated>2010-03-28T16:41:00+00:00</updated>
            <id>http://www.sharkpp.net/blog/2010/03/28/greasemonkey-wide-style-for-mediawiki.html</id>
            <content type="html"><![CDATA[<p>Mediawikiのデフォルトスタイルのサイドバーに開閉機能を付けるユーザースクリプトです。</p>

<p><img src="/images/2010_0328_wide_style_mediawiki.png" alt="" title="スクリーンショット" /></p>

<p><a href="http://userscripts.org/scripts/show/72660">DOWNLOAD</a></p>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[Google Trends Hot Searches insert Graph]]></title>
            <link href="http://www.sharkpp.net/blog/2010/01/05/greasemonkey-google-trends-hot-searches-insert-graph.html"/>
            <updated>2010-01-05T01:16:00+00:00</updated>
            <id>http://www.sharkpp.net/blog/2010/01/05/greasemonkey-google-trends-hot-searches-insert-graph.html</id>
            <content type="html"><![CDATA[<p>"Google Trends Hot Searches" にグラフを追加するユーザースクリプトです。</p>

<p><img src="/images/2010_0105_google_trends_insert_graph.png" alt="" title="スクリーンショット" /></p>

<p><a href="http://userscripts.org/scripts/show/65682">DOWNLOAD</a></p>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[tumblr easily modify publishing]]></title>
            <link href="http://www.sharkpp.net/blog/2009/07/19/greasemonkey-tumblr-easily-modify-publishing.html"/>
            <updated>2009-07-19T23:31:00+00:00</updated>
            <id>http://www.sharkpp.net/blog/2009/07/19/greasemonkey-tumblr-easily-modify-publishing.html</id>
            <content type="html"><![CDATA[<p>tumblr.のダッシュボードでの公開オプション(publish/private)を簡単に変更できるユーザースクリプトです。</p>

<p><img src="/images/2009_0719_tumblr_easily_modify_publishing.png" alt="" title="スクリーンショット" /></p>

<p><a href="http://userscripts.org/scripts/show/54020">DOWNLOAD</a></p>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[tumblr popup editor]]></title>
            <link href="http://www.sharkpp.net/blog/2009/07/19/greasemonkey-tumblr-popup-editor.html"/>
            <updated>2009-07-19T16:47:00+00:00</updated>
            <id>http://www.sharkpp.net/blog/2009/07/19/greasemonkey-tumblr-popup-editor.html</id>
            <content type="html"><![CDATA[<p>tumblr.の記事編集をポップアップで行えるユーザースクリプトです。</p>

<p><a href="http://userscripts.org/scripts/show/54011">DOWNLOAD</a></p>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[HSPコンテスト2008のロゴ置換]]></title>
            <link href="http://www.sharkpp.net/blog/2008/09/09/greasemonkey-hspcontest-2008-logo-change.html"/>
            <updated>2008-09-09T00:57:00+00:00</updated>
            <id>http://www.sharkpp.net/blog/2008/09/09/greasemonkey-hspcontest-2008-logo-change.html</id>
            <content type="html"><![CDATA[<p>HSPコンテスト2008のロゴを置換するユーザースクリプトです。</p>

<p><a href="/files/hspcontest_2008_logo_change.user.js">DOWNLOAD</a></p>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[GIGAZINEの続きを読むを自動で移動]]></title>
            <link href="http://www.sharkpp.net/blog/2008/09/09/greasemonkey-gigazine-auto-continue.html"/>
            <updated>2008-09-09T00:57:00+00:00</updated>
            <id>http://www.sharkpp.net/blog/2008/09/09/greasemonkey-gigazine-auto-continue.html</id>
            <content type="html"><![CDATA[<p>GIGAZINEの「続きを読む」を自動でそのリンク先に移動するユーザースクリプトです。</p>

<p><a href="/files/gigazine_auto_continue.user.js">DOWNLOAD</a></p>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[Vectorダウンロード画面をスキップ]]></title>
            <link href="http://www.sharkpp.net/blog/2008/09/09/greasemonkey-vector-download-info-skip.html"/>
            <updated>2008-09-09T00:56:00+00:00</updated>
            <id>http://www.sharkpp.net/blog/2008/09/09/greasemonkey-vector-download-info-skip.html</id>
            <content type="html"><![CDATA[<p><a href="/files/vector_download_info_skip.user.js">DOWNLOAD</a></p>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[HSP3掲示板のIPアドレスを表示]]></title>
            <link href="http://www.sharkpp.net/blog/2008/09/09/greasemonkey-hsp3bbs-ip-display.html"/>
            <updated>2008-09-09T00:56:00+00:00</updated>
            <id>http://www.sharkpp.net/blog/2008/09/09/greasemonkey-hsp3bbs-ip-display.html</id>
            <content type="html"><![CDATA[<p>HSP3掲示板にコメントとして書かれているIPアドレスを画面に表示するユーザースクリプトです。</p>

<p><a href="/files/hsp3bbs_ip_display.user.js">DOWNLOAD</a></p>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[slashdot.jpのフォントサイズを縮小]]></title>
            <link href="http://www.sharkpp.net/blog/2008/09/09/greasemonkey-slashdot-small-font.html"/>
            <updated>2008-09-09T00:55:00+00:00</updated>
            <id>http://www.sharkpp.net/blog/2008/09/09/greasemonkey-slashdot-small-font.html</id>
            <content type="html"><![CDATA[<p>slashdot.jpのフォントサイズを縮小するユーザースクリプトです。</p>

<p><a href="/files/slashdot_small_font.user.js">DOWNLOAD</a></p>
]]></content>
        </entry>
    </feed>